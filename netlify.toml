#############################################################################
# BACKOFFICE

## The following Netlify configurration is for the backoffice application ONLY
## In situations where multiple sites need to be deployed from a monorepo,
## Netlify configuration should be managed directly via the UI
#############################################################################

## -- BUILD -- ##

[build]
command = "npx nx build backoffice --skip-nx-cache && npx nx server:netlify backoffice --skip-nx-cache"
publish = "apps/backoffice/dist/public"

[build.environment]
PROJECT_NAME = "backoffice"

## - PROXY & CACHE -- ##

[[redirects]]
from = "/*"
status = 200
to = "/.netlify/functions/server"

# Favicon
[[headers]]
for = "/favicon.ico"
[headers.values]
"Cache-Control" = "public, max-age=3600"

# Images, Icons, etc.
[[headers]]
for = "/assets/*"
[headers.values]
"Cache-Control" = "public, max-age=3600"

# Remix
[[headers]]
for = "/build/*"
[headers.values]
"Cache-Control" = "public, max-age=60, s-maxage=60"

## -- FUNCTIONS -- ##

[functions]
directory = "apps/backoffice/dist/netlify"
external_node_modules = [
  "@remix-run/react",
  "@remix-run/node",
  "firebase-admin",
  "firebase",
  "isbot",
  "remix-typedjson",
  "tslog",
  "react-prismazoom",
  "node-ts-cache",
  "node-ts-cache-storage-memory",
  "lodash",
  "@uniformdev/canvas",
  "@uniformdev/canvas-react",
  "@uniformdev/context-remix",
  "@reduxjs/toolkit",
  "formik",
  "ramda",
  "ramda-adjunct",
  "react-redux",
  "yup",
  "axios",
  "classnames",
]
included_files = ["apps/backoffice/dist/index.js", "apps/backoffice/data/**", "apps/backoffice/config/*.json"]
node_bundler = "esbuild"

## -- PLUGINS -- ##

#[[plugins]]
#package = "./tools/plugins/netlify/affected-build"
